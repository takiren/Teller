# TellerEngine
ノベルゲーム用のエンジンです。
将来的にノードベースで進行管理するノベルゲームエンジンになる予定です。

## Overview
* TellerEngineがメインのプロジェクトフォルダ。
* 使用しているサブモジュールはCinder, json, fast-cpp-csv-parser。それ以外を使う予定は今のところない。

## ブランチについて
* master  
  ビルドが通ってるやつ安定版。
* develop/*  
  機能追加してるブランチ。
* [その他]  
  意味はないブランチ。

## 技術選定
* C++  
    将来的にマルチプラットフォーム対応したいためどこでも動くC++を採用。Chromiumやなんらかのオープンソースブラウザをバックエンドにしてjavascriptで実装するスタイルでもよかったが、Javascriptは1ヶ月ぐらい仲良くしていたためC++で決行。
* Cinder  
  OpenGLのラッパー。  低レベルで扱いやすく、マルチプラットフォーム対応、なおかつ2Dにも対応しているライブラリだったため採用。
* その他 
  実績が多いものを採用。  
  * jsonパーサー
  * csvパーサー

## 設計

グラフィックライブラリにOpenGLラッパーのCinderを使用。
マルチプラットフォーム対応を見据えできるだけ環境依存しないように標準ライブラリを使用して構築。

スマートポインタを使いそこそこスマートな実装になっているはず。

<img src="images\plantuml\ClassDiagram.png">

すべての機能をモジュールという単位に分解して機能拡張しやすくする。
* 実際のゲームで使用するモジュールはModuleCoreから継承。
* エディターで使用するモジュールはEditorから継承。


これによりエディターとゲームを別々に作らず開発できる。  
配布するためにはまた別の処理が必要ではある。
## 各クラス解説

### TellerCore
モジュールを管理するクラス。すべてのモジュールはここに集まる。

### ModuleCore
実際のゲームに使用されるモジュールの基底クラス。

### GameModule
Sceneを管理するクラス。
SceneをGameModuleで管理させることでシーン遷移を簡単に行える。

### SceneModule
Agentインスタンスを管理するクラス。


### Agent
Scene内で動くもの(UI、キャラクター)の基底クラス。

### Animation
Agentを操作するクラス。
Agent内関数のコールバック用関数を呼び出してAgentを操作する。

### AnimationSequencer
Animationクラスを管理するクラス。
AnimationクラスをAnimationSequencerが管理することで複数のAnimationインスタンスを
一つのエージェントに登録できる。

<img src="images\plantuml\Stack.png">


## 進捗
* 実際のゲームで使用するであろう機能は70%程度実装し終わった。
* ノードエディタ用の機能を組み込んだ。

## 今後の計画。
* 画像、音声の非同期ロード。
* レンダラーの非同期処理。

## モジュール管理の実装について。
スマートポインタで木構造を実装している。  
各モジュールは親を一つ(TellerCoreを除く)、子を複数持つ。
親への参照をweak_ptrで持ち子はshared_ptrで持つ。
理論上は親モジュールが所有権を放棄したらそれ以下のモジュールはスマートポインタによって
適切にdeleteされる。

>TellerEngine\Core.h

## 謝辞
先駆者の方々ありがとうございます。そしてこれからもお世話になります。

## 命名規則
+ 関数はすべて大文字から始まる。
+ 単語と単語の間にアンダースコアを使わない。
+ bool値は接頭辞b。
+ クラス内で使用する変数は末尾にアンダースコアを極力使用。
+ 引数で与えられる紛らわしい引数は接頭辞にアンダースコアを使用。